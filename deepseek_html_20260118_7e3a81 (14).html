<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—Ä—É—Ç–∞–ª—å–Ω–∞—è –ì–æ–Ω–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            touch-action: pan-y;
        }
        
        body {
            background-color: #111;
            font-family: 'Arial Black', sans-serif;
            overflow: hidden;
            color: #ff3300;
            text-shadow: 2px 2px 0 #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        #header {
            text-align: center;
            font-size: 24px;
            padding: 15px;
            background: linear-gradient(to bottom, #222, #000);
            border-bottom: 3px solid #ff3300;
            letter-spacing: 2px;
            width: 100%;
            box-shadow: 0 0 20px rgba(255, 51, 0, 0.3);
        }
        
        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 320px;
            height: 70vh;
            min-height: 500px;
            margin: 10px auto;
            overflow: hidden;
            background: #1a1a1a;
            border: 3px solid #ff3300;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255, 51, 0, 0.4);
        }
        
        #road {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #222;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }
        
        .lane {
            width: calc(100% / 3);
            height: 100%;
            border-right: 2px solid #ffcc00;
            position: relative;
        }
        
        .lane:last-child {
            border-right: none;
        }
        
        #car {
            position: absolute;
            width: 30px;
            height: 50px;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ff0000, #cc0000);
            border-radius: 5px 5px 0 0;
            z-index: 10;
            box-shadow: 0 3px 10px rgba(255, 0, 0, 0.6);
            transition: left 0.15s ease-out;
        }
        
        #car::before {
            content: '';
            position: absolute;
            width: 35px;
            height: 15px;
            background: #222;
            top: -10px;
            left: -2.5px;
            border-radius: 3px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.7);
        }
        
        #car::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #ff9900, #ff3300);
            top: 8px;
            left: -15px;
            border-radius: 50%;
            box-shadow: 
                45px 0 0 radial-gradient(circle, #ff9900, #ff3300),
                0 25px 0 #222,
                45px 25px 0 #222;
        }
        
        .car-window {
            position: absolute;
            width: 25px;
            height: 18px;
            background: rgba(0, 0, 0, 0.7);
            top: 5px;
            left: 2.5px;
            border-radius: 3px;
        }
        
        .obstacle {
            position: absolute;
            width: 70px;
            height: 60px;
            background: linear-gradient(135deg, #222, #000);
            border: 2px solid #ff3300;
            border-radius: 6px;
            z-index: 5;
            box-shadow: 0 0 15px rgba(255,51,0,0.9);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .obstacle-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .obstacle-fallback {
            font-size: 32px;
            color: #ff3300;
            text-shadow: 0 0 10px rgba(255,51,0,0.9);
        }
        
        .coin {
            position: absolute;
            width: 35px;
            height: 35px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
            border-radius: 50%;
            z-index: 5;
            box-shadow: 0 0 20px #FFD700;
            animation: spin 1.5s linear infinite;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .coin::before {
            content: '$';
            position: absolute;
            color: #8B7500;
            font-weight: bold;
            font-size: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        @keyframes spin {
            0% { transform: translateX(-50%) rotateY(0); }
            100% { transform: translateX(-50%) rotateY(360deg); }
        }
        
        #hud {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            z-index: 100;
            font-size: 16px;
            color: #ffcc00;
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border-radius: 10px;
            border: 2px solid #ff3300;
            box-shadow: 0 0 15px rgba(0,0,0,0.9);
        }
        
        .hud-item {
            text-align: center;
            flex: 1;
        }
        
        .hud-label {
            font-size: 12px;
            color: #ff9900;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .hud-value {
            font-size: 20px;
            color: #fff;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.98);
            padding: 20px;
            border: 4px solid #ff3300;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 1000;
            color: #ff3300;
            font-size: 22px;
            width: 90%;
            max-width: 300px;
            box-shadow: 0 0 50px rgba(255, 51, 0, 0.9);
        }
        
        #gameOver h2 {
            color: #ff0000;
            font-size: 28px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.9);
        }
        
        .fail-message {
            color: #ff9900;
            font-size: 24px;
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 51, 0, 0.1);
            border-radius: 8px;
            border: 2px solid #ff3300;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .crash-photo-container {
            margin: 20px 0;
            text-align: center;
            padding: 10px;
            background: rgba(255, 51, 0, 0.05);
            border-radius: 10px;
            border: 2px dashed #ff3300;
        }
        
        .crash-photo-label {
            color: #ff9900;
            font-size: 18px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .crash-photo {
            width: 180px;  /* –ë—ã–ª–æ 120px - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤ 1.5 —Ä–∞–∑–∞ */
            height: 150px; /* –ë—ã–ª–æ 100px - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤ 1.5 —Ä–∞–∑–∞ */
            object-fit: cover;
            border: 4px solid #ff3300;
            border-radius: 10px;
            margin: 0 auto;
            display: block;
            box-shadow: 0 0 30px rgba(255, 51, 0, 0.8);
        }
        
        .crash-photo-fallback {
            width: 180px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #222;
            border: 4px solid #ff3300;
            border-radius: 10px;
            margin: 0 auto;
            font-size: 60px;
            color: #ff3300;
            box-shadow: 0 0 30px rgba(255, 51, 0, 0.8);
        }
        
        .result-item {
            margin: 8px 0;
            font-size: 18px;
            color: #ffcc00;
        }
        
        .result-value {
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        #restartBtn {
            background: linear-gradient(to bottom, #ff3300, #8B0000);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 10px;
            margin-top: 20px;
            cursor: pointer;
            font-family: 'Arial Black', sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(255, 51, 0, 0.6);
        }
        
        #restartBtn:hover {
            background: linear-gradient(to bottom, #ff5500, #a52a2a);
            transform: scale(1.05);
            box-shadow: 0 7px 25px rgba(255, 51, 0, 0.8);
        }
        
        #controls {
            text-align: center;
            color: #ff9900;
            font-size: 14px;
            padding: 15px;
            width: 100%;
            max-width: 320px;
            margin-top: 10px;
            background: rgba(34, 34, 34, 0.9);
            border-radius: 10px;
            border: 1px solid #ff3300;
        }
        
        .swipe-instruction {
            font-size: 16px;
            color: #ffcc00;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .game-tip {
            font-size: 12px;
            color: #ccc;
            margin-top: 8px;
            font-style: italic;
        }
        
        .lane-indicator {
            position: absolute;
            bottom: 130px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 20;
        }
        
        .lane-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
            transition: all 0.3s;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .lane-dot.active {
            background: #ff3300;
            box-shadow: 0 0 10px #ff3300;
            transform: scale(1.3);
        }
        
        @keyframes bounceIn {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            70% { transform: translate(-50%, -50%) scale(0.9); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        #soundControl {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 51, 0, 0.8);
            border: 2px solid #ff9900;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: white;
            transition: all 0.3s;
            z-index: 100;
        }
        
        #soundControl:hover {
            background: rgba(255, 51, 0, 1);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.7);
        }
        
        #soundControl.muted {
            background: rgba(100, 100, 100, 0.8);
            border-color: #666;
        }
        
        #photoInfo {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
            color: #ffcc00;
            z-index: 100;
            border: 1px solid #ff3300;
        }
        
        #debugInfo {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            color: #ffcc00;
            z-index: 100;
            border: 1px solid #ff3300;
            max-width: 200px;
            display: none;
        }
        
        .debug-toggle {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(255, 51, 0, 0.8);
            border: 2px solid #ff9900;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: white;
            z-index: 100;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ñ–æ—Ç–æ */
        @keyframes photoZoom {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .crash-photo, .crash-photo-fallback {
            animation: photoZoom 0.7s ease-out;
        }
    </style>
</head>
<body>
    <div id="header">–≠–¥–æ –ø—Ä–∏–¥—É–º–∞–ª :)</div>
    
    <div id="gameContainer">
        <div id="road">
            <div class="lane" id="lane1"></div>
            <div class="lane" id="lane2"></div>
            <div class="lane" id="lane3"></div>
        </div>
        <div id="car">
            <div class="car-window"></div>
        </div>
        
        <div class="lane-indicator">
            <div class="lane-dot" id="dot1"></div>
            <div class="lane-dot" id="dot2"></div>
            <div class="lane-dot" id="dot3"></div>
        </div>
        
        <div id="soundControl">üîä</div>
        <div id="photoInfo">–§–æ—Ç–æ: <span id="loadedPhotos">0</span>/25</div>
        <div class="debug-toggle" id="debugToggle">üîç</div>
        <div id="debugInfo">
            <strong>–û—Ç–ª–∞–¥–∫–∞ —Ñ–æ—Ç–æ:</strong><br>
            <div id="debugLog"></div>
        </div>
        
        <div id="hud">
            <div class="hud-item">
                <div class="hud-label">–ú–æ–Ω–µ—Ç—ã</div>
                <div class="hud-value" id="coinCount">0</div>
            </div>
            <div class="hud-item">
                <div class="hud-label">–î–∏—Å—Ç–∞–Ω—Ü–∏—è</div>
                <div class="hud-value" id="distance">0</div>
            </div>
            <div class="hud-item">
                <div class="hud-label">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                <div class="hud-value" id="speed">25</div>
            </div>
        </div>
        
        <div id="gameOver">
            <h2>–ü–†–û–ò–ì–†–´–®!</h2>
            <div class="fail-message">–î–ê–í–ê–ô, –ü–û–®–ï–õ –¢–†–ï–ù–ò–†–û–í–ê–¢–¨–°–Ø!</div>
            
            <div class="crash-photo-container">
                <div class="crash-photo-label">–í–°–¢–†–ï–¢–ò–õ–°–Ø –°:</div>
                <img id="crashPhoto" class="crash-photo" style="display: none;">
                <div id="crashPhotoFallback" class="crash-photo-fallback" style="display: none;">‚ö†</div>
            </div>
            
            <div class="result-item">–ú–æ–Ω–µ—Ç—ã: <span class="result-value" id="finalCoins">0</span></div>
            <div class="result-item">–î–∏—Å—Ç–∞–Ω—Ü–∏—è: <span class="result-value" id="finalDistance">0</span> –º</div>
            <button id="restartBtn">–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê</button>
        </div>
    </div>
    
    <div id="controls">
        <div class="swipe-instruction">–°–≤–∞–π–ø–∞–π –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ –¥–ª—è —Å–º–µ–Ω—ã –ø–æ–ª–æ—Å—ã</div>
        <div class="game-tip">–ë–æ–ª—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ - –º–æ–∂–Ω–æ –æ–±—ä–µ—Ö–∞—Ç—å!</div>
        <div class="game-tip">–ò–≥—Ä–∞ –∏—â–µ—Ç —Ñ–æ—Ç–æ: 1, 2, 3... —Å –ª—é–±—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏</div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–≥—Ä—ã
        const car = document.getElementById('car');
        const road = document.getElementById('road');
        const coinCountElement = document.getElementById('coinCount');
        const distanceElement = document.getElementById('distance');
        const speedElement = document.getElementById('speed');
        const gameOverScreen = document.getElementById('gameOver');
        const finalCoinsElement = document.getElementById('finalCoins');
        const finalDistanceElement = document.getElementById('finalDistance');
        const restartBtn = document.getElementById('restartBtn');
        const laneDots = document.querySelectorAll('.lane-dot');
        const soundControl = document.getElementById('soundControl');
        const photoInfo = document.getElementById('loadedPhotos');
        const crashPhoto = document.getElementById('crashPhoto');
        const crashPhotoFallback = document.getElementById('crashPhotoFallback');
        const debugToggle = document.getElementById('debugToggle');
        const debugInfo = document.getElementById('debugInfo');
        const debugLog = document.getElementById('debugLog');
        
        // –í–°–ï –í–û–ó–ú–û–ñ–ù–´–ï –í–ê–†–ò–ê–ù–¢–´ –†–ê–°–®–ò–†–ï–ù–ò–ô
        const extensions = [
            '',           // –ë–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: "1", "2"...
            '.jpg',       // –° .jpg
            '.jpeg',      // –° .jpeg
            '.png',       // –° .png
            '.webp',      // –° .webp
            '.gif',       // –° .gif
            '.bmp',       // –° .bmp
            '.JPG',       // –° –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏
            '.JPEG',
            '.PNG',
            '.WEBP',
            '.GIF',
            '.BMP'
        ];
        
        // –ú–∞—Å—Å–∏–≤ –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
        let loadedPhotos = [];
        let lastCrashPhotoSrc = null;
        let lastCrashPhotoName = null;
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentLane = 1;
        let coins = 0;
        let distance = 0;
        let speed = 25; // –í 2 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
        let gameActive = true;
        let obstacles = [];
        let coinsArray = [];
        let gameLoop;
        let obstacleTimer;
        let coinTimer;
        let speedTimer;
        let lastSwipeTime = 0;
        const swipeCooldown = 150;
        let soundsEnabled = true;
        let audioContext;
        
        // –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        const MAX_ON_SCREEN_OBSTACLES = 3;
        
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ (–≤ –ø–∏–∫—Å–µ–ª—è—Ö)
        const MIN_OBSTACLE_DISTANCE = 250; // –ë—ã–ª–æ ~180, —Ç–µ–ø–µ—Ä—å –±–æ–ª—å—à–µ
        
        // –í—Ä–µ–º—è —Å –º–æ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        let lastObstacleTime = 0;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—Ç–ª–∞–¥–∫—É
        function addDebugMessage(message) {
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            debugLog.innerHTML = `<div>[${time}] ${message}</div>` + debugLog.innerHTML;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏
        debugToggle.addEventListener('click', function() {
            debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
        });
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Å–æ –í–°–ï–ú–ò –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
        async function loadPhotos() {
            loadedPhotos = [];
            let checkedFiles = 0;
            let foundFiles = 0;
            
            addDebugMessage("üöÄ –ù–∞—á–∏–Ω–∞—é –ø–æ–∏—Å–∫ —Ñ–æ—Ç–æ...");
            photoInfo.textContent = "–ü–æ–∏—Å–∫...";
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã –æ—Ç 1 –¥–æ 25
            for (let fileNumber = 1; fileNumber <= 25; fileNumber++) {
                let fileFound = false;
                
                // –ü—Ä–æ–±—É–µ–º –∫–∞–∂–¥–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞
                for (const ext of extensions) {
                    const filename = `${fileNumber}${ext}`;
                    checkedFiles++;
                    
                    try {
                        const exists = await checkFileExists(filename);
                        
                        if (exists) {
                            foundFiles++;
                            loadedPhotos.push({
                                filename: filename,
                                src: filename,
                                loaded: true,
                                number: fileNumber
                            });
                            
                            addDebugMessage(`‚úÖ –ù–∞–π–¥–µ–Ω–æ: ${filename}`);
                            fileFound = true;
                            break; // –ù–∞—à–ª–∏ —Ñ–∞–π–ª, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –Ω–æ–º–µ—Ä—É
                        }
                    } catch (error) {
                        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—à–∏–±–∫–∏, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å
                    }
                }
                
                if (!fileFound) {
                    addDebugMessage(`‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ñ–∞–π–ª –Ω–æ–º–µ—Ä ${fileNumber}`);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 5 —Ñ–∞–π–ª–æ–≤
                if (fileNumber % 5 === 0) {
                    photoInfo.textContent = `–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${fileNumber}/25`;
                }
                
                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            // –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            photoInfo.textContent = `${foundFiles}/25`;
            
            if (foundFiles > 0) {
                addDebugMessage(`üéâ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${foundFiles} —Ñ–æ—Ç–æ –∏–∑ ${checkedFiles} –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤`);
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–æ—Ç–æ –ø–æ –Ω–æ–º–µ—Ä—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                loadedPhotos.sort((a, b) => a.number - b.number);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
                let fileList = "–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:<br>";
                loadedPhotos.forEach(photo => {
                    fileList += `‚Ä¢ ${photo.filename}<br>`;
                });
                addDebugMessage(fileList);
            } else {
                addDebugMessage("üòû –§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:");
                addDebugMessage("1. –§–∞–π–ª—ã –Ω–µ –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ –∏–≥—Ä–∞");
                addDebugMessage("2. –§–∞–π–ª—ã –Ω–∞–∑–≤–∞–Ω—ã –Ω–µ 1, 2, 3...");
                addDebugMessage("3. –§–∞–π–ª—ã –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è");
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        function checkFileExists(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    addDebugMessage(`‚úì ${url} (${img.width}x${img.height})`);
                    resolve(true);
                };
                img.onerror = () => resolve(false);
                img.src = url;
                
                // –¢–∞–π–º–∞—É—Ç 500ms
                setTimeout(() => resolve(false), 500);
            });
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ
        function getRandomPhoto() {
            if (loadedPhotos.length === 0) {
                return null;
            }
            
            const randomIndex = Math.floor(Math.random() * loadedPhotos.length);
            return loadedPhotos[randomIndex];
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ç–æ –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
        function showCrashPhoto(photoSrc, photoName) {
            if (photoSrc) {
                crashPhoto.src = photoSrc;
                crashPhoto.style.display = 'block';
                crashPhotoFallback.style.display = 'none';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞
                document.querySelector('.crash-photo-label').textContent = 
                    `–í–°–¢–†–ï–¢–ò–õ–°–Ø –°: ${photoName || '—Ñ–æ—Ç–æ'}`;
            } else {
                crashPhoto.style.display = 'none';
                crashPhotoFallback.style.display = 'flex';
                document.querySelector('.crash-photo-label').textContent = '–í–°–¢–†–ï–¢–ò–õ–°–Ø –°: ‚ö†';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–µ–ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏—Ö—Å—è –ø–æ–ª–æ—Å
        function getRandomLanes() {
            // –í—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –º–∏–Ω–∏–º—É–º 1 —Å–≤–æ–±–æ–¥–Ω—É—é –ø–æ–ª–æ—Å—É –∏–∑ 3
            // –í–∞—Ä–∏–∞–Ω—Ç—ã: 0-1, 0-2, 1-2, 0, 1, 2
            const patterns = [
                [0],      // –¢–æ–ª—å–∫–æ –ª–µ–≤–∞—è –ø–æ–ª–æ—Å–∞
                [1],      // –¢–æ–ª—å–∫–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞
                [2],      // –¢–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞—è –ø–æ–ª–æ—Å–∞
                [0, 1],   // –õ–µ–≤–∞—è –∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è
                [1, 2],   // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∏ –ø—Ä–∞–≤–∞—è
                [0, 2]    // –õ–µ–≤–∞—è –∏ –ø—Ä–∞–≤–∞—è (—Å–≤–æ–±–æ–¥–Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è)
            ];
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω
            const randomPattern = patterns[Math.floor(Math.random() * patterns.length)];
            
            // –ï—Å–ª–∏ –≤—ã–ø–∞–ª –ø–∞—Ç—Ç–µ—Ä–Ω —Å –æ–¥–Ω–æ–π –ø–æ–ª–æ—Å–æ–π, –∏–Ω–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä—É—é (—Å —à–∞–Ω—Å–æ–º 30%)
            if (randomPattern.length === 1 && Math.random() < 0.3) {
                const singleLane = randomPattern[0];
                if (singleLane === 0) {
                    // –ï—Å–ª–∏ –∑–∞–Ω—è—Ç–∞ –ª–µ–≤–∞—è, –¥–æ–±–∞–≤–ª—è–µ–º –ª–∏–±–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é, –ª–∏–±–æ –ø—Ä–∞–≤—É—é
                    return Math.random() < 0.5 ? [0, 1] : [0, 2];
                } else if (singleLane === 1) {
                    // –ï—Å–ª–∏ –∑–∞–Ω—è—Ç–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, –¥–æ–±–∞–≤–ª—è–µ–º –ª–∏–±–æ –ª–µ–≤—É—é, –ª–∏–±–æ –ø—Ä–∞–≤—É—é
                    return Math.random() < 0.5 ? [0, 1] : [1, 2];
                } else if (singleLane === 2) {
                    // –ï—Å–ª–∏ –∑–∞–Ω—è—Ç–∞ –ø—Ä–∞–≤–∞—è, –¥–æ–±–∞–≤–ª—è–µ–º –ª–∏–±–æ –ª–µ–≤—É—é, –ª–∏–±–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é
                    return Math.random() < 0.5 ? [0, 2] : [1, 2];
                }
            }
            
            return randomPattern;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
        function checkMinDistance() {
            if (obstacles.length === 0) return true;
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–∞–º–æ–µ –Ω–∏–∂–Ω–µ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ
            let lowestObstacle = obstacles[0];
            for (const obs of obstacles) {
                if (obs.y > lowestObstacle.y) {
                    lowestObstacle = obs;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –¥–æ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞
            const distanceToTop = Math.abs(lowestObstacle.y - (-80));
            
            // –ï—Å–ª–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –≤–µ—Ä—Ö—É, –∂–¥–µ–º
            return distanceToTop > MIN_OBSTACLE_DISTANCE;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        async function initGame() {
            currentLane = 1;
            coins = 0;
            distance = 0;
            speed = 25; // –í 2 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
            gameActive = true;
            obstacles = [];
            coinsArray = [];
            lastSwipeTime = 0;
            lastCrashPhotoSrc = null;
            lastCrashPhotoName = null;
            lastObstacleTime = Date.now();
            
            updateCarPosition();
            updateLaneIndicator();
            coinCountElement.textContent = coins;
            distanceElement.textContent = distance;
            speedElement.textContent = speed;
            
            gameOverScreen.style.display = 'none';
            
            // –û—á–∏—Å—Ç–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
            document.querySelectorAll('.obstacle').forEach(o => o.remove());
            document.querySelectorAll('.coin').forEach(c => c.remove());
            
            // –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –º–∞—à–∏–Ω—ã
            car.style.background = 'linear-gradient(45deg, #ff0000, #cc0000)';
            car.style.boxShadow = '0 3px 10px rgba(255, 0, 0, 0.6)';
            car.style.transform = 'translateX(-50%) scale(1)';
            
            // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤
            if (gameLoop) clearInterval(gameLoop);
            if (obstacleTimer) clearInterval(obstacleTimer);
            if (coinTimer) clearInterval(coinTimer);
            if (speedTimer) clearInterval(speedTimer);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
            addDebugMessage("üîÑ –ù–∞—á–∏–Ω–∞—é –Ω–æ–≤—É—é –∏–≥—Ä—É...");
            await loadPhotos();
            
            startGame();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–∞–º–∏
        soundControl.addEventListener('click', function() {
            soundsEnabled = !soundsEnabled;
            
            if (soundsEnabled) {
                this.classList.remove('muted');
                this.innerHTML = 'üîä';
                if (!audioContext) {
                    initAudioContext();
                }
            } else {
                this.classList.add('muted');
                this.innerHTML = 'üîá';
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        function initAudioContext() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            } catch (e) {
                soundsEnabled = false;
                soundControl.classList.add('muted');
                soundControl.innerHTML = 'üîá';
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∑–≤—É–∫–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ
        document.addEventListener('click', function initAudio() {
            if (soundsEnabled && !audioContext) {
                initAudioContext();
            }
        }, { once: true });
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –º–æ–Ω–µ—Ç–∫–∏
        function playCoinSound() {
            if (!soundsEnabled || !audioContext) return;
            
            try {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.15);
                
            } catch (e) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∑–≤—É–∫–∞
            }
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∞–≤–∞—Ä–∏–∏
        function playCrashSound() {
            if (!soundsEnabled || !audioContext) return;
            
            try {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(180, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(60, audioContext.currentTime + 0.6);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.6);
                
            } catch (e) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∑–≤—É–∫–∞
            }
        }
        
        // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—à–∏–Ω—ã
        function updateCarPosition() {
            const roadWidth = road.offsetWidth;
            const laneWidth = roadWidth / 3;
            const carPosition = (laneWidth / 2) + (currentLane * laneWidth);
            car.style.left = carPosition + 'px';
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–ª–æ—Å—ã
        function updateLaneIndicator() {
            laneDots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentLane);
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
        function startGame() {
            if (loadedPhotos.length === 0) {
                addDebugMessage("‚ö† –ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ –±–µ–∑ —Ñ–æ—Ç–æ. –ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —ç–º–æ–¥–∑–∏.");
            }
            
            gameLoop = setInterval(updateGame, 50);
            obstacleTimer = setInterval(createObstacle, 2200); // –ï–©–ï –ú–ï–î–õ–ï–ù–ù–ï–ï - 2.2 —Å–µ–∫—É–Ω–¥—ã
            coinTimer = setInterval(createCoin, 1200); // –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–µ—Ç
            speedTimer = setInterval(increaseSpeed, 3000); // –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function updateGame() {
            if (!gameActive) return;
            
            distance += speed / 160; // –í 2 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏—Ä–æ—Å—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
            distanceElement.textContent = Math.floor(distance);
            
            updateObstacles();
            updateCoins();
            checkCollisions();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π - –ú–ï–ù–¨–®–ï –∏ –° –ë–û–õ–¨–®–ò–ú –†–ê–°–°–¢–û–Ø–ù–ò–ï–ú
        function createObstacle() {
            if (!gameActive) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–ª–∏—à–∫–æ–º –ª–∏ –º–Ω–æ–≥–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            if (obstacles.length >= MAX_ON_SCREEN_OBSTACLES) {
                addDebugMessage("‚ö† –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π, –ø—Ä–æ–ø—É—Å–∫–∞—é —Å–æ–∑–¥–∞–Ω–∏–µ");
                return;
            }
            
            // –®–∞–Ω—Å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ - 60% (–±—ã–ª–æ 70%)
            if (Math.random() > 0.6) {
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
            if (!checkMinDistance()) {
                addDebugMessage("‚ö† –°–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—é, –∂–¥—É...");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è —Å –º–æ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            const now = Date.now();
            const timeSinceLastObstacle = now - lastObstacleTime;
            if (timeSinceLastObstacle < 1500) { // –ú–∏–Ω–∏–º—É–º 1.5 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–æ—Å—ã –¥–ª—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π (–≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º —Å–≤–æ–±–æ–¥–Ω—É—é –ø–æ–ª–æ—Å—É)
            const lanes = getRandomLanes();
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª–æ—Å–∞—Ö
            lanes.forEach(laneIndex => {
                createSingleObstacle(laneIndex);
            });
            
            lastObstacleTime = now;
            addDebugMessage(`üõë –°–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –Ω–∞ –ø–æ–ª–æ—Å–∞—Ö: ${lanes.join(', ')} (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ >${MIN_OBSTACLE_DISTANCE}px)`);
        }
        
        function createSingleObstacle(laneIndex) {
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            
            const roadWidth = road.offsetWidth;
            const laneWidth = roadWidth / 3;
            const obstaclePosition = (laneWidth / 2) + (laneIndex * laneWidth);
            
            obstacle.style.left = obstaclePosition + 'px';
            obstacle.style.top = '-80px';
            
            const randomPhoto = getRandomPhoto();
            
            if (randomPhoto && loadedPhotos.length > 0) {
                const imgElement = document.createElement('img');
                imgElement.className = 'obstacle-photo';
                imgElement.src = randomPhoto.src;
                imgElement.alt = randomPhoto.filename;
                imgElement.dataset.photoSrc = randomPhoto.src;
                obstacle.appendChild(imgElement);
                
                obstacles.push({
                    element: obstacle,
                    lane: laneIndex,
                    y: -80,
                    width: 70,
                    height: 60,
                    photoSrc: randomPhoto.src,
                    photoName: randomPhoto.filename
                });
            } else {
                const fallbackElement = document.createElement('div');
                fallbackElement.className = 'obstacle-fallback';
                fallbackElement.textContent = '‚ö†';
                obstacle.appendChild(fallbackElement);
                
                obstacles.push({
                    element: obstacle,
                    lane: laneIndex,
                    y: -80,
                    width: 70,
                    height: 60,
                    photoSrc: null,
                    photoName: null
                });
            }
            
            road.appendChild(obstacle);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–µ—Ç
        function createCoin() {
            if (!gameActive || Math.random() < 0.5) return; // –ú–µ–Ω—å—à–µ –º–æ–Ω–µ—Ç
            
            const laneIndex = Math.floor(Math.random() * 3);
            const coin = document.createElement('div');
            coin.className = 'coin';
            
            const roadWidth = road.offsetWidth;
            const laneWidth = roadWidth / 3;
            const coinPosition = (laneWidth / 2) + (laneIndex * laneWidth);
            
            coin.style.left = coinPosition + 'px';
            coin.style.top = '-40px';
            
            road.appendChild(coin);
            coinsArray.push({
                element: coin,
                lane: laneIndex,
                y: -40,
                width: 35,
                height: 35
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π - –í 2 –†–ê–ó–ê –ú–ï–î–õ–ï–ù–ù–ï–ï!
        function updateObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obs = obstacles[i];
                obs.y += speed / 12; // –ë—ã–ª–æ /6, —Å—Ç–∞–ª–æ /12 (–≤ 2 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
                obs.element.style.top = obs.y + 'px';
                
                if (obs.y > road.offsetHeight) {
                    obs.element.remove();
                    obstacles.splice(i, 1);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç - –í 2 –†–ê–ó–ê –ú–ï–î–õ–ï–ù–ù–ï–ï!
        function updateCoins() {
            for (let i = coinsArray.length - 1; i >= 0; i--) {
                const coin = coinsArray[i];
                coin.y += speed / 12; // –ë—ã–ª–æ /6, —Å—Ç–∞–ª–æ /12 (–≤ 2 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
                coin.element.style.top = coin.y + 'px';
                
                if (coin.y > road.offsetHeight) {
                    coin.element.remove();
                    coinsArray.splice(i, 1);
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        function checkCollisions() {
            const carRect = {
                lane: currentLane,
                x: parseFloat(car.style.left) - 15,
                y: road.offsetHeight - 120,
                width: 30,
                height: 50
            };
            
            for (const obs of obstacles) {
                if (obs.lane === carRect.lane) {
                    const obsRect = {
                        x: parseFloat(obs.element.style.left) - 35,
                        y: obs.y,
                        width: 70,
                        height: 60
                    };
                    
                    if (detectCollision(carRect, obsRect)) {
                        lastCrashPhotoSrc = obs.photoSrc;
                        lastCrashPhotoName = obs.photoName;
                        if (obs.photoName) {
                            addDebugMessage(`üí• –í—Ä–µ–∑–∞–ª—Å—è –≤: ${obs.photoName} (–ø–æ–ª–æ—Å–∞ ${obs.lane + 1})`);
                        }
                        gameOver();
                        return;
                    }
                }
            }
            
            for (let i = coinsArray.length - 1; i >= 0; i--) {
                const coin = coinsArray[i];
                if (coin.lane === carRect.lane) {
                    const coinRect = {
                        x: parseFloat(coin.element.style.left) - 17.5,
                        y: coin.y,
                        width: 35,
                        height: 35
                    };
                    
                    if (detectCollision(carRect, coinRect)) {
                        coins++;
                        coinCountElement.textContent = coins;
                        coin.element.remove();
                        coinsArray.splice(i, 1);
                        
                        playCoinSound();
                        
                        car.style.boxShadow = '0 0 25px rgba(255, 215, 0, 1)';
                        setTimeout(() => {
                            car.style.boxShadow = '0 3px 10px rgba(255, 0, 0, 0.6)';
                        }, 150);
                    }
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        function detectCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ - –ú–ï–î–õ–ï–ù–ù–ï–ï!
        function increaseSpeed() {
            if (!gameActive) return;
            speed = Math.min(speed + 2, 60); // –ë—ã–ª–æ +3 –¥–æ 120, —Å—Ç–∞–ª–æ +2 –¥–æ 60
            speedElement.textContent = speed;
        }
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            gameActive = false;
            clearInterval(gameLoop);
            clearInterval(obstacleTimer);
            clearInterval(coinTimer);
            clearInterval(speedTimer);
            
            finalCoinsElement.textContent = coins;
            finalDistanceElement.textContent = Math.floor(distance);
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∞–≤–∞—Ä–∏–∏
            playCrashSound();
            
            // –≠—Ñ—Ñ–µ–∫—Ç –≤–∑—Ä—ã–≤–∞
            car.style.background = 'linear-gradient(45deg, #ff3300, #ff0000)';
            car.style.boxShadow = '0 0 40px rgba(255, 0, 0, 0.9)';
            car.style.transform = 'translateX(-50%) scale(1.1)';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ (–ë–û–õ–¨–®–ï–ì–û –†–ê–ó–ú–ï–†–ê)
            setTimeout(() => {
                showCrashPhoto(lastCrashPhotoSrc, lastCrashPhotoName);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(() => {
                    gameOverScreen.style.display = 'block';
                    gameOverScreen.style.animation = 'bounceIn 0.5s';
                }, 300);
            }, 200);
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞–º–∏
        let touchStartX = 0;
        const minSwipeDistance = 40;
        
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });
        
        document.addEventListener('touchend', (e) => {
            if (!gameActive) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const diffX = touchEndX - touchStartX;
            
            if (Math.abs(diffX) > minSwipeDistance) {
                const currentTime = Date.now();
                if (currentTime - lastSwipeTime > swipeCooldown) {
                    lastSwipeTime = currentTime;
                    
                    if (diffX > 0 && currentLane < 2) {
                        currentLane++;
                        updateCarPosition();
                        updateLaneIndicator();
                    } else if (diffX < 0 && currentLane > 0) {
                        currentLane--;
                        updateCarPosition();
                        updateLaneIndicator();
                    }
                }
            }
        });
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            
            const currentTime = Date.now();
            if (currentTime - lastSwipeTime > swipeCooldown) {
                lastSwipeTime = currentTime;
                
                if ((e.key === 'ArrowLeft' || e.key === 'a') && currentLane > 0) {
                    currentLane--;
                    updateCarPosition();
                    updateLaneIndicator();
                } else if ((e.key === 'ArrowRight' || e.key === 'd') && currentLane < 2) {
                    currentLane++;
                    updateCarPosition();
                    updateLaneIndicator();
                }
            }
        });
        
        // –ö–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
        restartBtn.addEventListener('click', initGame);
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        window.addEventListener('load', () => {
            initGame();
            setTimeout(updateCarPosition, 100);
        });
        
        window.addEventListener('resize', updateCarPosition);
    </script>
</body>
</html>